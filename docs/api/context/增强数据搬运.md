# 增强数据搬运<a name="ZH-CN_TOPIC_0000002382867725"></a>

## 产品支持情况<a name="section1550532418810"></a>

<a name="table38301303189"></a>
<table><thead align="left"><tr id="row20831180131817"><th class="cellrowborder" valign="top" width="53.64%" id="mcps1.1.4.1.1"><p id="p1883113061818"><a name="p1883113061818"></a><a name="p1883113061818"></a><span id="ph20833205312295"><a name="ph20833205312295"></a><a name="ph20833205312295"></a>产品</span></p>
</th>
<th class="cellrowborder" align="center" valign="top" width="25.09%" id="mcps1.1.4.1.2"><p id="p224040201611"><a name="p224040201611"></a><a name="p224040201611"></a>是否支持</p>
<p id="p44264172453"><a name="p44264172453"></a><a name="p44264172453"></a><strong id="b12426617194517"><a name="b12426617194517"></a><a name="b12426617194517"></a>源操作数和目的操作数</strong></p>
<p id="p119981415104019"><a name="p119981415104019"></a><a name="p119981415104019"></a><strong id="b1057693816427"><a name="b1057693816427"></a><a name="b1057693816427"></a>类型一致</strong>的原型</p>
</th>
<th class="cellrowborder" align="center" valign="top" width="21.27%" id="mcps1.1.4.1.3"><p id="p124241133174419"><a name="p124241133174419"></a><a name="p124241133174419"></a>是否支持</p>
<p id="p183213194459"><a name="p183213194459"></a><a name="p183213194459"></a><strong id="b58321419134518"><a name="b58321419134518"></a><a name="b58321419134518"></a>源操作数和目的操作数</strong></p>
<p id="p942413364418"><a name="p942413364418"></a><a name="p942413364418"></a><strong id="b1942433384411"><a name="b1942433384411"></a><a name="b1942433384411"></a>类型不一致</strong>的原型</p>
</th>
</tr>
</thead>
<tbody><tr id="row220181016240"><td class="cellrowborder" valign="top" width="53.64%" headers="mcps1.1.4.1.1 "><p id="p48327011813"><a name="p48327011813"></a><a name="p48327011813"></a><span id="ph583230201815"><a name="ph583230201815"></a><a name="ph583230201815"></a><term id="zh-cn_topic_0000001312391781_term1253731311225"><a name="zh-cn_topic_0000001312391781_term1253731311225"></a><a name="zh-cn_topic_0000001312391781_term1253731311225"></a>Atlas A3 训练系列产品</term>/<term id="zh-cn_topic_0000001312391781_term131434243115"><a name="zh-cn_topic_0000001312391781_term131434243115"></a><a name="zh-cn_topic_0000001312391781_term131434243115"></a>Atlas A3 推理系列产品</term></span></p>
</td>
<td class="cellrowborder" align="center" valign="top" width="25.09%" headers="mcps1.1.4.1.2 "><p id="p7948163910184"><a name="p7948163910184"></a><a name="p7948163910184"></a>√</p>
</td>
<td class="cellrowborder" align="center" valign="top" width="21.27%" headers="mcps1.1.4.1.3 "><p id="p1338191161717"><a name="p1338191161717"></a><a name="p1338191161717"></a>x</p>
</td>
</tr>
<tr id="row173226882415"><td class="cellrowborder" valign="top" width="53.64%" headers="mcps1.1.4.1.1 "><p id="p14832120181815"><a name="p14832120181815"></a><a name="p14832120181815"></a><span id="ph1483216010188"><a name="ph1483216010188"></a><a name="ph1483216010188"></a><term id="zh-cn_topic_0000001312391781_term11962195213215"><a name="zh-cn_topic_0000001312391781_term11962195213215"></a><a name="zh-cn_topic_0000001312391781_term11962195213215"></a>Atlas A2 训练系列产品</term>/<term id="zh-cn_topic_0000001312391781_term184716139811"><a name="zh-cn_topic_0000001312391781_term184716139811"></a><a name="zh-cn_topic_0000001312391781_term184716139811"></a>Atlas A2 推理系列产品</term></span></p>
</td>
<td class="cellrowborder" align="center" valign="top" width="25.09%" headers="mcps1.1.4.1.2 "><p id="p19948143911820"><a name="p19948143911820"></a><a name="p19948143911820"></a>√</p>
</td>
<td class="cellrowborder" align="center" valign="top" width="21.27%" headers="mcps1.1.4.1.3 "><p id="p103384116176"><a name="p103384116176"></a><a name="p103384116176"></a>x</p>
</td>
</tr>
</tbody>
</table>

## 功能说明<a name="section474617392321"></a>

对数据搬运能力进行增强，相比于基础数据搬运接口，增加了CO1-\>CO2通路的随路计算。

## 函数原型<a name="section1954364615315"></a>

-   Global Memory -\> Local Memory

    ```
    template <typename T>
    __aicore__ inline void DataCopy(const LocalTensor<T>& dst, const GlobalTensor<T>& src, const DataCopyParams& intriParams, const DataCopyEnhancedParams& enhancedParams)
    ```

-   Local Memory -\> Local Memory

    ```
    template <typename T>
    __aicore__ inline void DataCopy(const LocalTensor<T>& dst, const LocalTensor<T>& src, const DataCopyParams& intriParams, const DataCopyEnhancedParams& enhancedParams)
    ```

-   Local Memory -\> Global Memory

    ```
    template <typename T>
    __aicore__ inline void DataCopy(const GlobalTensor<T>& dst, const LocalTensor<T>& src, const DataCopyParams& intriParams, const DataCopyEnhancedParams& enhancedParams)
    ```

-   Local Memory -\>  Local  Memory，支持源操作数和目的操作数类型不一致

    ```
    template <typename T, typename U>
    __aicore__ inline void DataCopy(const LocalTensor<T>& dst, const LocalTensor<U>& src, const DataCopyParams& intriParams, const DataCopyEnhancedParams& enhancedParams)
    ```

> [!NOTE]说明 
>各原型支持的具体数据通路和数据类型，请参考[支持的通路和数据类型](#section8664371012)。

## 参数说明<a name="section1592117358563"></a>

**表 1**  模板参数说明

<a name="table4835205712588"></a>
<table><thead align="left"><tr id="zh-cn_topic_0000001429830437_row118356578583"><th class="cellrowborder" valign="top" width="14.729999999999999%" id="mcps1.2.3.1.1"><p id="zh-cn_topic_0000001429830437_p48354572582"><a name="zh-cn_topic_0000001429830437_p48354572582"></a><a name="zh-cn_topic_0000001429830437_p48354572582"></a>参数名</p>
</th>
<th class="cellrowborder" valign="top" width="85.27%" id="mcps1.2.3.1.2"><p id="zh-cn_topic_0000001429830437_p583535795817"><a name="zh-cn_topic_0000001429830437_p583535795817"></a><a name="zh-cn_topic_0000001429830437_p583535795817"></a>描述</p>
</th>
</tr>
</thead>
<tbody><tr id="zh-cn_topic_0000001429830437_row1835857145817"><td class="cellrowborder" valign="top" width="14.729999999999999%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0000001429830437_p5835457165816"><a name="zh-cn_topic_0000001429830437_p5835457165816"></a><a name="zh-cn_topic_0000001429830437_p5835457165816"></a>T、U</p>
</td>
<td class="cellrowborder" valign="top" width="85.27%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0000001429830437_p168351657155818"><a name="zh-cn_topic_0000001429830437_p168351657155818"></a><a name="zh-cn_topic_0000001429830437_p168351657155818"></a>操作数的数据类型。支持的数据类型请参考<a href="#section8664371012">支持的通路和数据类型</a>。</p>
</td>
</tr>
</tbody>
</table>

**表 2**  参数说明

<a name="table3224323162213"></a>
<table><thead align="left"><tr id="row522432372218"><th class="cellrowborder" valign="top" width="15.02%" id="mcps1.2.4.1.1"><p id="p122241923112220"><a name="p122241923112220"></a><a name="p122241923112220"></a>参数名称</p>
</th>
<th class="cellrowborder" valign="top" width="10%" id="mcps1.2.4.1.2"><p id="p52241023112212"><a name="p52241023112212"></a><a name="p52241023112212"></a>输入/输出</p>
</th>
<th class="cellrowborder" valign="top" width="74.98%" id="mcps1.2.4.1.3"><p id="p1422413239223"><a name="p1422413239223"></a><a name="p1422413239223"></a>含义</p>
</th>
</tr>
</thead>
<tbody><tr id="row622492392213"><td class="cellrowborder" valign="top" width="15.02%" headers="mcps1.2.4.1.1 "><p id="p1224423152212"><a name="p1224423152212"></a><a name="p1224423152212"></a>dst</p>
</td>
<td class="cellrowborder" valign="top" width="10%" headers="mcps1.2.4.1.2 "><p id="p1022410233225"><a name="p1022410233225"></a><a name="p1022410233225"></a>输出</p>
</td>
<td class="cellrowborder" valign="top" width="74.98%" headers="mcps1.2.4.1.3 "><p id="p2225323202216"><a name="p2225323202216"></a><a name="p2225323202216"></a>目的操作数，类型为LocalTensor或GlobalTensor。</p>
</td>
</tr>
<tr id="row1022512318222"><td class="cellrowborder" valign="top" width="15.02%" headers="mcps1.2.4.1.1 "><p id="p16225162392212"><a name="p16225162392212"></a><a name="p16225162392212"></a>src</p>
</td>
<td class="cellrowborder" valign="top" width="10%" headers="mcps1.2.4.1.2 "><p id="p1022522320223"><a name="p1022522320223"></a><a name="p1022522320223"></a>输入</p>
</td>
<td class="cellrowborder" valign="top" width="74.98%" headers="mcps1.2.4.1.3 "><p id="p52251223122218"><a name="p52251223122218"></a><a name="p52251223122218"></a>源操作数，类型为LocalTensor或GlobalTensor。</p>
</td>
</tr>
<tr id="row162251223152212"><td class="cellrowborder" valign="top" width="15.02%" headers="mcps1.2.4.1.1 "><p id="p1822516233228"><a name="p1822516233228"></a><a name="p1822516233228"></a>intriParams</p>
</td>
<td class="cellrowborder" valign="top" width="10%" headers="mcps1.2.4.1.2 "><p id="p162258239220"><a name="p162258239220"></a><a name="p162258239220"></a>输入</p>
</td>
<td class="cellrowborder" valign="top" width="74.98%" headers="mcps1.2.4.1.3 "><p id="p112251223192216"><a name="p112251223192216"></a><a name="p112251223192216"></a>搬运参数。<a href="基础数据搬运.md#table9182515919">DataCopyParams</a>类型。</p>
</td>
</tr>
<tr id="row2022522352212"><td class="cellrowborder" valign="top" width="15.02%" headers="mcps1.2.4.1.1 "><p id="p16225223162217"><a name="p16225223162217"></a><a name="p16225223162217"></a>enhancedParams</p>
</td>
<td class="cellrowborder" valign="top" width="10%" headers="mcps1.2.4.1.2 "><p id="p18225132316220"><a name="p18225132316220"></a><a name="p18225132316220"></a>输入</p>
</td>
<td class="cellrowborder" valign="top" width="74.98%" headers="mcps1.2.4.1.3 "><p id="p11522183075510"><a name="p11522183075510"></a><a name="p11522183075510"></a>增强信息参数。<a href="#table18951548102317">DataCopyEnhancedParams</a>类型。</p>
<p id="p395104375712"><a name="p395104375712"></a><a name="p395104375712"></a>具体定义请参考<span id="ph10562197165916"><a name="ph10562197165916"></a><a name="ph10562197165916"></a>${INSTALL_DIR}</span>/include/ascendc/basic_api/interface/kernel_struct_data_copy.h，<span id="ph14322531015"><a name="ph14322531015"></a><a name="ph14322531015"></a>${INSTALL_DIR}</span>请替换为CANN软件安装后文件存储路径。</p>
</td>
</tr>
</tbody>
</table>

**表 3**  DataCopyEnhancedParams结构参数说明

<a name="table18951548102317"></a>
<table><thead align="left"><tr id="row1889504819231"><th class="cellrowborder" valign="top" width="17.06%" id="mcps1.2.3.1.1"><p id="p208951548122311"><a name="p208951548122311"></a><a name="p208951548122311"></a>参数名称</p>
</th>
<th class="cellrowborder" valign="top" width="82.94%" id="mcps1.2.3.1.2"><p id="p18959486232"><a name="p18959486232"></a><a name="p18959486232"></a>含义</p>
</th>
</tr>
</thead>
<tbody><tr id="row1289564862313"><td class="cellrowborder" valign="top" width="17.06%" headers="mcps1.2.3.1.1 "><p id="p6219154112712"><a name="p6219154112712"></a><a name="p6219154112712"></a>blockMode</p>
</td>
<td class="cellrowborder" valign="top" width="82.94%" headers="mcps1.2.3.1.2 "><p id="p187822381986"><a name="p187822381986"></a><a name="p187822381986"></a>数据搬移基本分形，BlockMode枚举类型，支持以下配置：</p>
<a name="ul1756617401186"></a><a name="ul1756617401186"></a><ul id="ul1756617401186"><li>BLOCK_MODE_NORMAL：表示传输单位为32B。当前暂不支持。</li><li>BLOCK_MODE_MATRIX：表示传输单位为一个16 * 16的cube分形。</li><li>BLOCK_MODE_VECTOR：表示传输单位为一个1 * 16的cube分形。</li><li>BLOCK_MODE_SMALL_CHANNEL：表示传输单位为一个16 * 4的cube分形。当前暂不支持。</li><li>BLOCK_MODE_DEPTHWISE：表示传输单位为一个16 * 16的cube分形，提供随路channel-split功能。当前暂不支持。</li></ul>
<p id="p9722194114920"><a name="p9722194114920"></a><a name="p9722194114920"></a>每种模式下对应的blockLen等参数单位见<a href="#table13396838183618">表4</a>。</p>
</td>
</tr>
<tr id="row186241356152711"><td class="cellrowborder" valign="top" width="17.06%" headers="mcps1.2.3.1.1 "><p id="p422194102716"><a name="p422194102716"></a><a name="p422194102716"></a>deqScale</p>
</td>
<td class="cellrowborder" valign="top" width="82.94%" headers="mcps1.2.3.1.2 "><p id="p1322124172716"><a name="p1322124172716"></a><a name="p1322124172716"></a>随路精度转换辅助参数，即量化模式，支持的量化模式取值和对应的数据类型等信息请参考<a href="#table168091348673">表5</a>。其中DEQ、DEQ8、DEQ16模式，需要传入deqValue量化系数，设置deqValue的对应比特位；VDEQ、VDEQ8、VDEQ16模式，需要传入包含16个元素（deqValue）的量化参数向量，设置deqTensorAddr的对应比特位，同时保证DEQADDR中存储的反量化参数向量的每个元素（deqValue）都符合预期和使用限制。</p>
<p id="p13652734172720"><a name="p13652734172720"></a><a name="p13652734172720"></a>VDEQ模式下，反量化参数向量长度为32Byte（16个half元素）；其他模式下，反量化参数向量长度为128Byte（16个64bit的反量化元素）。</p>
</td>
</tr>
<tr id="row4753155642719"><td class="cellrowborder" valign="top" width="17.06%" headers="mcps1.2.3.1.1 "><p id="p722134152715"><a name="p722134152715"></a><a name="p722134152715"></a>deqValue</p>
</td>
<td class="cellrowborder" valign="top" width="82.94%" headers="mcps1.2.3.1.2 "><p id="p102218412719"><a name="p102218412719"></a><a name="p102218412719"></a>量化系数。 deqValue的配置方式请参考<a href="#table54451538192912">deqValue配置方式</a>。</p>
</td>
</tr>
<tr id="row1739363112208"><td class="cellrowborder" valign="top" width="17.06%" headers="mcps1.2.3.1.1 "><p id="p14393831112011"><a name="p14393831112011"></a><a name="p14393831112011"></a>deqTensorAddr</p>
</td>
<td class="cellrowborder" valign="top" width="82.94%" headers="mcps1.2.3.1.2 "><p id="p203601226123717"><a name="p203601226123717"></a><a name="p203601226123717"></a>UB中存储反量化参数向量的起始地址。deqScale为VDEQ/VDEQ8/VDEQ16模式时，需要传入反量化运算时的参数向量的地址。该地址要满足32B对齐。</p>
<p id="p167361722205720"><a name="p167361722205720"></a><a name="p167361722205720"></a>对于VDEQ模式，该地址指向32B大小的反量化参数向量，其中每个元素大小为16bit(half)。</p>
<p id="p197361228579"><a name="p197361228579"></a><a name="p197361228579"></a>对于VDEQ8、VDEQ16模式，反量化参数向量中的每个元素大小都为64bit。搬运时会搬运blockCount个连续传输数据块，每个数据块的长度为blockLen。每个数据块对应一个128Byte的反量化向量。对于同一个数据块，反量化参数向量中的16个元素会被连续复用。不同的数据块，对应不同的反量化参数向量，地址会相应的偏移128B。例如：假设对应起始地址为A，第一个数据块的128B反量化参数向量起始地址为A，第二个数据块的128B反量化参数向量起始地址为A + 128B。</p>
<p id="p57366224579"><a name="p57366224579"></a><a name="p57366224579"></a>同一个反量化参数向量的每一个元素的MCB标志位必须一致。</p>
</td>
</tr>
<tr id="row18953165652718"><td class="cellrowborder" valign="top" width="17.06%" headers="mcps1.2.3.1.1 "><p id="p82211415278"><a name="p82211415278"></a><a name="p82211415278"></a>sidStoreMode</p>
</td>
<td class="cellrowborder" valign="top" width="82.94%" headers="mcps1.2.3.1.2 "><p id="p713218554016"><a name="p713218554016"></a><a name="p713218554016"></a>用于deqScale为DEQ8/VDEQ8时配置存储模式，控制反量化结果如何存储在dst地址中。配置效果参考<a href="#fig5416115192414">sidStoreMode配置示意图</a>。</p>
<a name="ul1576811134211"></a><a name="ul1576811134211"></a><ul id="ul1576811134211"><li>0：dst的数据存储在每个DataBlock的前半段，即每32B的高16B</li><li>1：dst的数据存储在每个DataBlock的后半段，即每32B的低16B</li><li>2：dst的数据存储在完整的DataBlock中，即整个32B</li></ul>
</td>
</tr>
<tr id="row12112857182717"><td class="cellrowborder" valign="top" width="17.06%" headers="mcps1.2.3.1.1 "><p id="p5221194152717"><a name="p5221194152717"></a><a name="p5221194152717"></a>isRelu</p>
</td>
<td class="cellrowborder" valign="top" width="82.94%" headers="mcps1.2.3.1.2 "><p id="p522117413272"><a name="p522117413272"></a><a name="p522117413272"></a>配置是否可以随路做线性整流操作。配置deqValue的情况下，如果该参数被置为true，那么会刷新deqValue的Relu标志位为1；如果被置为false，则不会做修改。配置deqTensorAddr的情况下，反量化参数向量元素中的Relu标志位不生效，以isRelu为准。</p>
<p id="p9915947111119"><a name="p9915947111119"></a><a name="p9915947111119"></a>仅配置isRelu，不配置量化参数，即deqValue配置为DEQ_NONE场景，支持src和dst的数据类型组合如下：{half，half}，{float，float}，{int32_t，int32_t}，{float，half}；同时配置isRelu和量化参数的场景，支持的数据类型组合参考<a href="#table168091348673">表5</a>。</p>
</td>
</tr>
<tr id="row6321757152711"><td class="cellrowborder" valign="top" width="17.06%" headers="mcps1.2.3.1.1 "><p id="p822184142719"><a name="p822184142719"></a><a name="p822184142719"></a>padMode</p>
</td>
<td class="cellrowborder" valign="top" width="82.94%" headers="mcps1.2.3.1.2 "><p id="p1022214192712"><a name="p1022214192712"></a><a name="p1022214192712"></a>预留参数，当前暂不支持。</p>
</td>
</tr>
</tbody>
</table>

**表 4**  不同blockMode对应的参数单位

<a name="table13396838183618"></a>
<table><thead align="left"><tr id="row123966384365"><th class="cellrowborder" valign="top" width="18.61186118611861%" id="mcps1.2.8.1.1"><p id="p9147159101311"><a name="p9147159101311"></a><a name="p9147159101311"></a>blockMode</p>
</th>
<th class="cellrowborder" valign="top" width="7.800780078007801%" id="mcps1.2.8.1.2"><p id="p1839633893611"><a name="p1839633893611"></a><a name="p1839633893611"></a>src</p>
</th>
<th class="cellrowborder" valign="top" width="8.85088508850885%" id="mcps1.2.8.1.3"><p id="p8396193814361"><a name="p8396193814361"></a><a name="p8396193814361"></a>dst</p>
</th>
<th class="cellrowborder" valign="top" width="20.642064206420642%" id="mcps1.2.8.1.4"><p id="p1339614389361"><a name="p1339614389361"></a><a name="p1339614389361"></a>数据类型</p>
</th>
<th class="cellrowborder" valign="top" width="12.651265126512651%" id="mcps1.2.8.1.5"><p id="p139614389369"><a name="p139614389369"></a><a name="p139614389369"></a>blockLen单位</p>
</th>
<th class="cellrowborder" valign="top" width="15.721572157215721%" id="mcps1.2.8.1.6"><p id="p1639673833613"><a name="p1639673833613"></a><a name="p1639673833613"></a>srcStride单位</p>
</th>
<th class="cellrowborder" valign="top" width="15.721572157215721%" id="mcps1.2.8.1.7"><p id="p339612384365"><a name="p339612384365"></a><a name="p339612384365"></a>dstStride单位</p>
</th>
</tr>
</thead>
<tbody><tr id="row10396133811369"><td class="cellrowborder" rowspan="5" valign="top" width="18.61186118611861%" headers="mcps1.2.8.1.1 "><p id="p01471359101318"><a name="p01471359101318"></a><a name="p01471359101318"></a>BLOCK_MODE_NORMAL</p>
</td>
<td class="cellrowborder" valign="top" width="7.800780078007801%" headers="mcps1.2.8.1.2 "><p id="p1539617384366"><a name="p1539617384366"></a><a name="p1539617384366"></a>GM</p>
</td>
<td class="cellrowborder" valign="top" width="8.85088508850885%" headers="mcps1.2.8.1.3 "><p id="p1339673815363"><a name="p1339673815363"></a><a name="p1339673815363"></a>A1</p>
</td>
<td class="cellrowborder" valign="top" width="20.642064206420642%" headers="mcps1.2.8.1.4 "><p id="p1637813022613"><a name="p1637813022613"></a><a name="p1637813022613"></a>int8_t、uint8_t、int16_t、uint16_t、int32_t、uint32_t、int64_t、 uint64_t、 half、bfloat16_t、float、double</p>
</td>
<td class="cellrowborder" valign="top" width="12.651265126512651%" headers="mcps1.2.8.1.5 "><p id="p15396193893612"><a name="p15396193893612"></a><a name="p15396193893612"></a>32B</p>
</td>
<td class="cellrowborder" valign="top" width="15.721572157215721%" headers="mcps1.2.8.1.6 "><p id="p153966388365"><a name="p153966388365"></a><a name="p153966388365"></a>32B</p>
</td>
<td class="cellrowborder" valign="top" width="15.721572157215721%" headers="mcps1.2.8.1.7 "><p id="p5397123803620"><a name="p5397123803620"></a><a name="p5397123803620"></a>32B</p>
</td>
</tr>
<tr id="row53974381368"><td class="cellrowborder" valign="top" headers="mcps1.2.8.1.1 "><p id="p10397438113619"><a name="p10397438113619"></a><a name="p10397438113619"></a>GM</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.8.1.2 "><p id="p13397133843612"><a name="p13397133843612"></a><a name="p13397133843612"></a>B1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.8.1.3 "><p id="p86891366270"><a name="p86891366270"></a><a name="p86891366270"></a>int8_t、uint8_t、int16_t、uint16_t、int32_t、uint32_t、int64_t、 uint64_t、 half、bfloat16_t、float、double</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.8.1.4 "><p id="p2397103843612"><a name="p2397103843612"></a><a name="p2397103843612"></a>32B</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.8.1.5 "><p id="p17397133803616"><a name="p17397133803616"></a><a name="p17397133803616"></a>32B</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.8.1.6 "><p id="p83971238183615"><a name="p83971238183615"></a><a name="p83971238183615"></a>32B</p>
</td>
</tr>
<tr id="row143971038173617"><td class="cellrowborder" valign="top" headers="mcps1.2.8.1.1 "><p id="p53974389364"><a name="p53974389364"></a><a name="p53974389364"></a>GM</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.8.1.2 "><p id="p15397173813364"><a name="p15397173813364"></a><a name="p15397173813364"></a>VECIN</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.8.1.3 "><p id="p1820725152716"><a name="p1820725152716"></a><a name="p1820725152716"></a>int8_t、uint8_t、int16_t、uint16_t、int32_t、uint32_t、int64_t、 uint64_t、 half、bfloat16_t、float、double</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.8.1.4 "><p id="p2397113803610"><a name="p2397113803610"></a><a name="p2397113803610"></a>32B</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.8.1.5 "><p id="p163971138143614"><a name="p163971138143614"></a><a name="p163971138143614"></a>32B</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.8.1.6 "><p id="p939715381364"><a name="p939715381364"></a><a name="p939715381364"></a>32B</p>
</td>
</tr>
<tr id="row14397203817363"><td class="cellrowborder" valign="top" headers="mcps1.2.8.1.1 "><p id="p19397113863614"><a name="p19397113863614"></a><a name="p19397113863614"></a>VECOUT</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.8.1.2 "><p id="p113971338123610"><a name="p113971338123610"></a><a name="p113971338123610"></a>GM</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.8.1.3 "><p id="p2345172816278"><a name="p2345172816278"></a><a name="p2345172816278"></a>int8_t、uint8_t、int16_t、uint16_t、int32_t、uint32_t、int64_t、 uint64_t、 half、bfloat16_t、float、double</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.8.1.4 "><p id="p1939743820363"><a name="p1939743820363"></a><a name="p1939743820363"></a>32B</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.8.1.5 "><p id="p33971838113615"><a name="p33971838113615"></a><a name="p33971838113615"></a>32B</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.8.1.6 "><p id="p73976383364"><a name="p73976383364"></a><a name="p73976383364"></a>32B</p>
</td>
</tr>
<tr id="row939823823612"><td class="cellrowborder" valign="top" headers="mcps1.2.8.1.1 "><p id="p16398438163615"><a name="p16398438163615"></a><a name="p16398438163615"></a>VECIN</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.8.1.2 "><p id="p23981538113618"><a name="p23981538113618"></a><a name="p23981538113618"></a>VECOUT</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.8.1.3 "><p id="p3345112842719"><a name="p3345112842719"></a><a name="p3345112842719"></a>int8_t、uint8_t、int16_t、uint16_t、int32_t、uint32_t、int64_t、 uint64_t、 half、bfloat16_t、float、double</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.8.1.4 "><p id="p18398838193615"><a name="p18398838193615"></a><a name="p18398838193615"></a>32B</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.8.1.5 "><p id="p4398238183618"><a name="p4398238183618"></a><a name="p4398238183618"></a>32B</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.8.1.6 "><p id="p539812386368"><a name="p539812386368"></a><a name="p539812386368"></a>32B</p>
</td>
</tr>
<tr id="row13405153491312"><td class="cellrowborder" rowspan="2" valign="top" width="18.61186118611861%" headers="mcps1.2.8.1.1 "><p id="p121471959141316"><a name="p121471959141316"></a><a name="p121471959141316"></a>BLOCK_MODE_MATRIX</p>
</td>
<td class="cellrowborder" valign="top" width="7.800780078007801%" headers="mcps1.2.8.1.2 "><p id="p20115848151319"><a name="p20115848151319"></a><a name="p20115848151319"></a>CO1</p>
</td>
<td class="cellrowborder" valign="top" width="8.85088508850885%" headers="mcps1.2.8.1.3 "><p id="p1115748151317"><a name="p1115748151317"></a><a name="p1115748151317"></a>CO2</p>
</td>
<td class="cellrowborder" valign="top" width="20.642064206420642%" headers="mcps1.2.8.1.4 "><p id="p851619234520"><a name="p851619234520"></a><a name="p851619234520"></a>half、int16_t、uint16_t</p>
</td>
<td class="cellrowborder" valign="top" width="12.651265126512651%" headers="mcps1.2.8.1.5 "><p id="p511574851318"><a name="p511574851318"></a><a name="p511574851318"></a>512B</p>
</td>
<td class="cellrowborder" valign="top" width="15.721572157215721%" headers="mcps1.2.8.1.6 "><p id="p2115748101310"><a name="p2115748101310"></a><a name="p2115748101310"></a>512B</p>
</td>
<td class="cellrowborder" valign="top" width="15.721572157215721%" headers="mcps1.2.8.1.7 "><p id="p20115448181311"><a name="p20115448181311"></a><a name="p20115448181311"></a>32B</p>
</td>
</tr>
<tr id="row15379236181312"><td class="cellrowborder" valign="top" headers="mcps1.2.8.1.1 "><p id="p2115164816135"><a name="p2115164816135"></a><a name="p2115164816135"></a>CO1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.8.1.2 "><p id="p1115154841312"><a name="p1115154841312"></a><a name="p1115154841312"></a>CO2</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.8.1.3 "><p id="p12891530155211"><a name="p12891530155211"></a><a name="p12891530155211"></a>float、int32_t、uint32_t</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.8.1.4 "><p id="p20115448191315"><a name="p20115448191315"></a><a name="p20115448191315"></a>1024B</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.8.1.5 "><p id="p15115148161315"><a name="p15115148161315"></a><a name="p15115148161315"></a>1024B</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.8.1.6 "><p id="p1011534871311"><a name="p1011534871311"></a><a name="p1011534871311"></a>32B</p>
</td>
</tr>
<tr id="row17623103914131"><td class="cellrowborder" rowspan="2" valign="top" width="18.61186118611861%" headers="mcps1.2.8.1.1 "><p id="p15147105914138"><a name="p15147105914138"></a><a name="p15147105914138"></a>BLOCK_MODE_VECTOR</p>
</td>
<td class="cellrowborder" valign="top" width="7.800780078007801%" headers="mcps1.2.8.1.2 "><p id="p1078195116133"><a name="p1078195116133"></a><a name="p1078195116133"></a>CO1</p>
</td>
<td class="cellrowborder" valign="top" width="8.85088508850885%" headers="mcps1.2.8.1.3 "><p id="p57811251171319"><a name="p57811251171319"></a><a name="p57811251171319"></a>CO2</p>
</td>
<td class="cellrowborder" valign="top" width="20.642064206420642%" headers="mcps1.2.8.1.4 "><p id="p11944134375216"><a name="p11944134375216"></a><a name="p11944134375216"></a>half、int16_t、uint16_t</p>
</td>
<td class="cellrowborder" valign="top" width="12.651265126512651%" headers="mcps1.2.8.1.5 "><p id="p4781751171314"><a name="p4781751171314"></a><a name="p4781751171314"></a>32B</p>
</td>
<td class="cellrowborder" valign="top" width="15.721572157215721%" headers="mcps1.2.8.1.6 "><p id="p478118519131"><a name="p478118519131"></a><a name="p478118519131"></a>512B</p>
</td>
<td class="cellrowborder" valign="top" width="15.721572157215721%" headers="mcps1.2.8.1.7 "><p id="p9781451171317"><a name="p9781451171317"></a><a name="p9781451171317"></a>32B</p>
</td>
</tr>
<tr id="row4207144461316"><td class="cellrowborder" valign="top" headers="mcps1.2.8.1.1 "><p id="p678115115131"><a name="p678115115131"></a><a name="p678115115131"></a>CO1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.8.1.2 "><p id="p578114519134"><a name="p578114519134"></a><a name="p578114519134"></a>CO2</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.8.1.3 "><p id="p0912149175212"><a name="p0912149175212"></a><a name="p0912149175212"></a>float、int32_t、uint32_t</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.8.1.4 "><p id="p6781105110137"><a name="p6781105110137"></a><a name="p6781105110137"></a>64B</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.8.1.5 "><p id="p20782165111312"><a name="p20782165111312"></a><a name="p20782165111312"></a>1024B</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.8.1.6 "><p id="p3782175110133"><a name="p3782175110133"></a><a name="p3782175110133"></a>32B</p>
</td>
</tr>
</tbody>
</table>

**表 5**  deqScale参数列表

<a name="table168091348673"></a>
<table><thead align="left"><tr id="row1781015484713"><th class="cellrowborder" valign="top" width="23.580000000000002%" id="mcps1.2.5.1.1"><p id="p481010481275"><a name="p481010481275"></a><a name="p481010481275"></a>量化模式</p>
</th>
<th class="cellrowborder" valign="top" width="23.56%" id="mcps1.2.5.1.2"><p id="p78105481375"><a name="p78105481375"></a><a name="p78105481375"></a>src.dtype</p>
</th>
<th class="cellrowborder" valign="top" width="31.009999999999998%" id="mcps1.2.5.1.3"><p id="p138101248376"><a name="p138101248376"></a><a name="p138101248376"></a>dst.dtype</p>
</th>
<th class="cellrowborder" valign="top" width="21.85%" id="mcps1.2.5.1.4"><p id="p33171735151419"><a name="p33171735151419"></a><a name="p33171735151419"></a>配合使用的参数</p>
</th>
</tr>
</thead>
<tbody><tr id="row1481074814710"><td class="cellrowborder" valign="top" width="23.580000000000002%" headers="mcps1.2.5.1.1 "><p id="p18103487714"><a name="p18103487714"></a><a name="p18103487714"></a>DEQ</p>
</td>
<td class="cellrowborder" valign="top" width="23.56%" headers="mcps1.2.5.1.2 "><p id="p48105481175"><a name="p48105481175"></a><a name="p48105481175"></a>int32_t</p>
</td>
<td class="cellrowborder" valign="top" width="31.009999999999998%" headers="mcps1.2.5.1.3 "><p id="p1481017489719"><a name="p1481017489719"></a><a name="p1481017489719"></a>half</p>
</td>
<td class="cellrowborder" rowspan="2" valign="top" width="21.85%" headers="mcps1.2.5.1.4 "><p id="p831714356145"><a name="p831714356145"></a><a name="p831714356145"></a>deqValue中的变量M</p>
</td>
</tr>
<tr id="row16810048172"><td class="cellrowborder" valign="top" headers="mcps1.2.5.1.1 "><p id="p198102484718"><a name="p198102484718"></a><a name="p198102484718"></a>DEQ</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.2 "><p id="p68104482718"><a name="p68104482718"></a><a name="p68104482718"></a>half</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.3 "><p id="p68108483718"><a name="p68108483718"></a><a name="p68108483718"></a>half</p>
</td>
</tr>
<tr id="row2081094818711"><td class="cellrowborder" valign="top" width="23.580000000000002%" headers="mcps1.2.5.1.1 "><p id="p481113481472"><a name="p481113481472"></a><a name="p481113481472"></a>DEQ8</p>
</td>
<td class="cellrowborder" valign="top" width="23.56%" headers="mcps1.2.5.1.2 "><p id="p128111648176"><a name="p128111648176"></a><a name="p128111648176"></a>int32_t</p>
</td>
<td class="cellrowborder" valign="top" width="31.009999999999998%" headers="mcps1.2.5.1.3 "><p id="p1681117483719"><a name="p1681117483719"></a><a name="p1681117483719"></a>int8_t</p>
</td>
<td class="cellrowborder" rowspan="2" valign="top" width="21.85%" headers="mcps1.2.5.1.4 "><a name="ul155581712155718"></a><a name="ul155581712155718"></a><ul id="ul155581712155718"><li>deqValue<a name="ul14395918105719"></a><a name="ul14395918105719"></a><ul id="ul14395918105719"><li>变量M</li><li>变量N</li><li>MCB标志位</li><li>Offset</li><li>Sign标志位</li><li>Relu标志位</li></ul>
</li><li>isRelu</li></ul>
</td>
</tr>
<tr id="row881174810719"><td class="cellrowborder" valign="top" headers="mcps1.2.5.1.1 "><p id="p88112481578"><a name="p88112481578"></a><a name="p88112481578"></a>DEQ8</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.2 "><p id="p1281116484716"><a name="p1281116484716"></a><a name="p1281116484716"></a>int32_t</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.3 "><p id="p188111848274"><a name="p188111848274"></a><a name="p188111848274"></a>uint8_t</p>
</td>
</tr>
<tr id="row381115481370"><td class="cellrowborder" valign="top" width="23.580000000000002%" headers="mcps1.2.5.1.1 "><p id="p6811184815716"><a name="p6811184815716"></a><a name="p6811184815716"></a>DEQ16</p>
</td>
<td class="cellrowborder" valign="top" width="23.56%" headers="mcps1.2.5.1.2 "><p id="p58116486719"><a name="p58116486719"></a><a name="p58116486719"></a>int32_t</p>
</td>
<td class="cellrowborder" valign="top" width="31.009999999999998%" headers="mcps1.2.5.1.3 "><p id="p148114483713"><a name="p148114483713"></a><a name="p148114483713"></a>half</p>
</td>
<td class="cellrowborder" valign="top" width="21.85%" headers="mcps1.2.5.1.4 "><a name="ul1926419173582"></a><a name="ul1926419173582"></a><ul id="ul1926419173582"><li>deqValue<a name="ul0264171718587"></a><a name="ul0264171718587"></a><ul id="ul0264171718587"><li>变量M</li><li>变量N</li><li>MCB标志位</li><li>Relu标志位</li></ul>
</li></ul>
<a name="ul1580163255816"></a><a name="ul1580163255816"></a><ul id="ul1580163255816"><li>isRelu</li></ul>
</td>
</tr>
<tr id="row68111481971"><td class="cellrowborder" valign="top" width="23.580000000000002%" headers="mcps1.2.5.1.1 "><p id="p58118481970"><a name="p58118481970"></a><a name="p58118481970"></a>DEQ16</p>
</td>
<td class="cellrowborder" valign="top" width="23.56%" headers="mcps1.2.5.1.2 "><p id="p1881216481573"><a name="p1881216481573"></a><a name="p1881216481573"></a>int32_t</p>
</td>
<td class="cellrowborder" valign="top" width="31.009999999999998%" headers="mcps1.2.5.1.3 "><p id="p281215481177"><a name="p281215481177"></a><a name="p281215481177"></a>int16_t</p>
</td>
<td class="cellrowborder" valign="top" width="21.85%" headers="mcps1.2.5.1.4 "><a name="ul12405954195811"></a><a name="ul12405954195811"></a><ul id="ul12405954195811"><li>deqValue<a name="ul114061854125813"></a><a name="ul114061854125813"></a><ul id="ul114061854125813"><li>变量N</li><li>Relu标志位</li></ul>
</li><li>isRelu</li></ul>
</td>
</tr>
<tr id="row15859124012618"><td class="cellrowborder" valign="top" width="23.580000000000002%" headers="mcps1.2.5.1.1 "><p id="p48108483713"><a name="p48108483713"></a><a name="p48108483713"></a>VDEQ</p>
</td>
<td class="cellrowborder" valign="top" width="23.56%" headers="mcps1.2.5.1.2 "><p id="p481016481971"><a name="p481016481971"></a><a name="p481016481971"></a>int32_t</p>
</td>
<td class="cellrowborder" valign="top" width="31.009999999999998%" headers="mcps1.2.5.1.3 "><p id="p1881034810719"><a name="p1881034810719"></a><a name="p1881034810719"></a>half</p>
</td>
<td class="cellrowborder" rowspan="5" valign="top" width="21.85%" headers="mcps1.2.5.1.4 "><p id="p462655718597"><a name="p462655718597"></a><a name="p462655718597"></a>deqTensorAddr地址存储的反量化参数向量中的元素deqValue支持配置的参数分别对应DEQ/DEQ8/DEQ16的说明。</p>
<a name="ul2200722135910"></a><a name="ul2200722135910"></a><ul id="ul2200722135910"><li>deqTensorAddr<a name="ul14159204465916"></a><a name="ul14159204465916"></a><ul id="ul14159204465916"><li>DEQADDR</li><li>Relu标志位</li></ul>
</li><li>isRelu</li></ul>
</td>
</tr>
<tr id="row65771537132613"><td class="cellrowborder" valign="top" headers="mcps1.2.5.1.1 "><p id="p20811548677"><a name="p20811548677"></a><a name="p20811548677"></a>VDEQ8</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.2 "><p id="p18111048075"><a name="p18111048075"></a><a name="p18111048075"></a>int32_t</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.3 "><p id="p1281116480715"><a name="p1281116480715"></a><a name="p1281116480715"></a>int8_t</p>
</td>
</tr>
<tr id="row348005220264"><td class="cellrowborder" valign="top" headers="mcps1.2.5.1.1 "><p id="p38119481473"><a name="p38119481473"></a><a name="p38119481473"></a>VDEQ8</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.2 "><p id="p881113488719"><a name="p881113488719"></a><a name="p881113488719"></a>int32_t</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.3 "><p id="p1081194818718"><a name="p1081194818718"></a><a name="p1081194818718"></a>uint8_t</p>
</td>
</tr>
<tr id="row108120481775"><td class="cellrowborder" valign="top" headers="mcps1.2.5.1.1 "><p id="p1381210481470"><a name="p1381210481470"></a><a name="p1381210481470"></a>VDEQ16</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.2 "><p id="p78125482719"><a name="p78125482719"></a><a name="p78125482719"></a>int32_t</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.3 "><p id="p17812134812714"><a name="p17812134812714"></a><a name="p17812134812714"></a>half</p>
</td>
</tr>
<tr id="row38121748578"><td class="cellrowborder" valign="top" headers="mcps1.2.5.1.1 "><p id="p1181214481673"><a name="p1181214481673"></a><a name="p1181214481673"></a>VDEQ16</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.2 "><p id="p13812548372"><a name="p13812548372"></a><a name="p13812548372"></a>int32_t</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.3 "><p id="p1781204818719"><a name="p1781204818719"></a><a name="p1781204818719"></a>int16_t</p>
</td>
</tr>
</tbody>
</table>

**表 6**  deqValue配置方式

<a name="table54451538192912"></a>
<table><thead align="left"><tr id="row9445113817295"><th class="cellrowborder" valign="top" width="10.81%" id="mcps1.2.5.1.1"><p id="p1917517190160"><a name="p1917517190160"></a><a name="p1917517190160"></a>模式</p>
</th>
<th class="cellrowborder" valign="top" width="9.629999999999999%" id="mcps1.2.5.1.2"><p id="p18445238162917"><a name="p18445238162917"></a><a name="p18445238162917"></a>比特位数</p>
</th>
<th class="cellrowborder" valign="top" width="9.950000000000001%" id="mcps1.2.5.1.3"><p id="p844523872920"><a name="p844523872920"></a><a name="p844523872920"></a>变量名</p>
</th>
<th class="cellrowborder" valign="top" width="69.61%" id="mcps1.2.5.1.4"><p id="p16275115893116"><a name="p16275115893116"></a><a name="p16275115893116"></a>作用介绍</p>
</th>
</tr>
</thead>
<tbody><tr id="row144454389297"><td class="cellrowborder" rowspan="7" valign="top" width="10.81%" headers="mcps1.2.5.1.1 "><p id="p1517519192166"><a name="p1517519192166"></a><a name="p1517519192166"></a>DEQ8、VDEQ8、DEQ16、VDEQ16</p>
</td>
<td class="cellrowborder" valign="top" width="9.629999999999999%" headers="mcps1.2.5.1.2 "><p id="p174453387298"><a name="p174453387298"></a><a name="p174453387298"></a>0~31</p>
</td>
<td class="cellrowborder" valign="top" width="9.950000000000001%" headers="mcps1.2.5.1.3 "><p id="p1468919312326"><a name="p1468919312326"></a><a name="p1468919312326"></a>M</p>
</td>
<td class="cellrowborder" valign="top" width="69.61%" headers="mcps1.2.5.1.4 "><p id="p327510582314"><a name="p327510582314"></a><a name="p327510582314"></a>32位数视为float，作为反量化计算所需要乘的值。src为int32_t，dst为int16_t的场景下，变量M不生效。</p>
</td>
</tr>
<tr id="row164461438162915"><td class="cellrowborder" valign="top" headers="mcps1.2.5.1.1 "><p id="p11446163812290"><a name="p11446163812290"></a><a name="p11446163812290"></a>32~35</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.2 "><p id="p244612384295"><a name="p244612384295"></a><a name="p244612384295"></a>N</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.3 "><p id="p936413185354"><a name="p936413185354"></a><a name="p936413185354"></a>4位比特位，表示范围为[1, 16](b'0000对应表示1， b'1111对应表示16)。</p>
<p id="p122751758203113"><a name="p122751758203113"></a><a name="p122751758203113"></a>当模式为DEQ8、VDEQ8时，MCB标志位置为1时，将输入的值进行右移N比特位。当模式为DEQ16、VDEQ16并且dst数据类型为int16_t时，直接进行N位的右移，不受MCB标志位控制。</p>
</td>
</tr>
<tr id="row144614387295"><td class="cellrowborder" valign="top" headers="mcps1.2.5.1.1 "><p id="p344643862917"><a name="p344643862917"></a><a name="p344643862917"></a>36</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.2 "><p id="p104461238142912"><a name="p104461238142912"></a><a name="p104461238142912"></a>MCB标志位</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.3 "><p id="p1027535823112"><a name="p1027535823112"></a><a name="p1027535823112"></a>Mode Control Bit。如果置为0，输入的int32_t会被直接转换为float。如果置为1，输入的int32_t会先右移N比特位，转变成int16_t，然后转换为float。</p>
</td>
</tr>
<tr id="row134461238142914"><td class="cellrowborder" valign="top" headers="mcps1.2.5.1.1 "><p id="p6446153810291"><a name="p6446153810291"></a><a name="p6446153810291"></a>37~45</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.2 "><p id="p7328185113813"><a name="p7328185113813"></a><a name="p7328185113813"></a>Offset</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.3 "><p id="p18275105810316"><a name="p18275105810316"></a><a name="p18275105810316"></a>9bit的整形数据，在进行反量化src * M的计算结果后与Offset进行相加。仅在DEQ8、VDEQ8模式中会用到。如果不使用offset，请置为0。</p>
</td>
</tr>
<tr id="row544615389297"><td class="cellrowborder" valign="top" headers="mcps1.2.5.1.1 "><p id="p34461138182918"><a name="p34461138182918"></a><a name="p34461138182918"></a>46</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.2 "><p id="p1344619386296"><a name="p1344619386296"></a><a name="p1344619386296"></a>Sign标志位</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.3 "><p id="p327515863114"><a name="p327515863114"></a><a name="p327515863114"></a>如果置为1，表明反量化结果是signed(int8)；如果为置为0，表明反量化结果是unsigned(uint8)。仅在DEQ8、VDEQ8模式中会用到。</p>
</td>
</tr>
<tr id="row15446238172917"><td class="cellrowborder" valign="top" headers="mcps1.2.5.1.1 "><p id="p18446538122910"><a name="p18446538122910"></a><a name="p18446538122910"></a>47</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.2 "><p id="p544633814293"><a name="p544633814293"></a><a name="p544633814293"></a>Relu标志位</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.3 "><p id="p1027535816316"><a name="p1027535816316"></a><a name="p1027535816316"></a>如果置为1，对最终结果进行RELU计算；如果置为0，不进行额外计算。</p>
<a name="ul1990518110205"></a><a name="ul1990518110205"></a><ul id="ul1990518110205"><li>对于int32_t-&gt;int8_t，配置RELU时，offset必须配置成-128；</li><li>对于int32_t-&gt;uint8_t，配置RELU时，offset必须配置成0。</li></ul>
</td>
</tr>
<tr id="row2446143818295"><td class="cellrowborder" valign="top" headers="mcps1.2.5.1.1 "><p id="p6446123819299"><a name="p6446123819299"></a><a name="p6446123819299"></a>48~63</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.2 "><p id="p044643812299"><a name="p044643812299"></a><a name="p044643812299"></a>-</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.3 "><p id="p17276195843117"><a name="p17276195843117"></a><a name="p17276195843117"></a>预留</p>
</td>
</tr>
<tr id="row18730181615244"><td class="cellrowborder" valign="top" headers="mcps1.2.5.1.1 "><p id="p19657175012410"><a name="p19657175012410"></a><a name="p19657175012410"></a>DEQ、VDEQ</p>
</td>
<td class="cellrowborder" colspan="3" valign="top" headers="mcps1.2.5.1.2 mcps1.2.5.1.3 mcps1.2.5.1.4 "><p id="p246482462415"><a name="p246482462415"></a><a name="p246482462415"></a>0 ~ 15对应变量M， 这16位数被视为half，作为反量化计算需要乘的值。</p>
</td>
</tr>
</tbody>
</table>

**图 1**  sidStoreMode配置示意图<a name="fig5416115192414"></a>  
![](figures/sidStoreMode配置示意图.png "sidStoreMode配置示意图")

## 返回值说明<a name="section16867144513189"></a>

无

## 约束说明<a name="section633mcpsimp"></a>

-   开发者需要保证DataCopyEnhancedParams中的isRelu参数配置和量化系数deqValue/量化参数向量deqTensorAddr的RELU标志位配置一致：都开启或都不开启。
-   如果CO1-\>CO2有随路精度转换，通路为UB的操作数的blockLen单位需要减半。

## 支持的通路和数据类型<a name="section8664371012"></a>

下文的数据通路均通过逻辑位置[TPosition](TPosition.md#table5376122715308)来表达，并注明了对应的物理通路。TPosition与物理内存的映射关系见[表1](通用说明和约束.md#table07372185712)。

**表 7**  enhancedParams不生效时支持的通路（此时支持接口调用但增强数据搬运不生效，功能等同于基础数据搬运）

<a name="table14255161718545"></a>
<table><thead align="left"><tr id="row3255181710543"><th class="cellrowborder" valign="top" width="47.13%" id="mcps1.2.3.1.1"><p id="p52550177546"><a name="p52550177546"></a><a name="p52550177546"></a>支持型号</p>
</th>
<th class="cellrowborder" valign="top" width="52.87%" id="mcps1.2.3.1.2"><p id="p13255191735420"><a name="p13255191735420"></a><a name="p13255191735420"></a>数据通路</p>
</th>
</tr>
</thead>
<tbody><tr id="row5426164114556"><td class="cellrowborder" valign="top" width="47.13%" headers="mcps1.2.3.1.1 "><p id="p44261641165518"><a name="p44261641165518"></a><a name="p44261641165518"></a><span id="ph14504143371016"><a name="ph14504143371016"></a><a name="ph14504143371016"></a><term id="zh-cn_topic_0000001312391781_term11962195213215_1"><a name="zh-cn_topic_0000001312391781_term11962195213215_1"></a><a name="zh-cn_topic_0000001312391781_term11962195213215_1"></a>Atlas A2 训练系列产品</term>/<term id="zh-cn_topic_0000001312391781_term184716139811_1"><a name="zh-cn_topic_0000001312391781_term184716139811_1"></a><a name="zh-cn_topic_0000001312391781_term184716139811_1"></a>Atlas A2 推理系列产品</term></span></p>
</td>
<td class="cellrowborder" valign="top" width="52.87%" headers="mcps1.2.3.1.2 "><p id="p3454155275911"><a name="p3454155275911"></a><a name="p3454155275911"></a>GM -&gt; VECIN</p>
<p id="p2454552155916"><a name="p2454552155916"></a><a name="p2454552155916"></a>GM -&gt; A1、B1</p>
<p id="p645495295916"><a name="p645495295916"></a><a name="p645495295916"></a>VECIN -&gt; VECCALC或VECCALC -&gt; VECOUT</p>
<p id="p71018256454"><a name="p71018256454"></a><a name="p71018256454"></a>VECIN、VECCALC、VECOUT -&gt; TSCM</p>
<p id="p6238122715485"><a name="p6238122715485"></a><a name="p6238122715485"></a>VECOUT -&gt; GM</p>
<p id="p253637174812"><a name="p253637174812"></a><a name="p253637174812"></a>A1、B1 -&gt; GM</p>
</td>
</tr>
<tr id="row53201313156"><td class="cellrowborder" valign="top" width="47.13%" headers="mcps1.2.3.1.1 "><p id="p183201835156"><a name="p183201835156"></a><a name="p183201835156"></a><span id="ph16239174011416"><a name="ph16239174011416"></a><a name="ph16239174011416"></a><term id="zh-cn_topic_0000001312391781_term1253731311225_1"><a name="zh-cn_topic_0000001312391781_term1253731311225_1"></a><a name="zh-cn_topic_0000001312391781_term1253731311225_1"></a>Atlas A3 训练系列产品</term>/<term id="zh-cn_topic_0000001312391781_term131434243115_1"><a name="zh-cn_topic_0000001312391781_term131434243115_1"></a><a name="zh-cn_topic_0000001312391781_term131434243115_1"></a>Atlas A3 推理系列产品</term></span></p>
</td>
<td class="cellrowborder" valign="top" width="52.87%" headers="mcps1.2.3.1.2 "><p id="p19284656195914"><a name="p19284656195914"></a><a name="p19284656195914"></a>GM -&gt; VECIN</p>
<p id="p82851056115915"><a name="p82851056115915"></a><a name="p82851056115915"></a>GM -&gt; A1、B1</p>
<p id="p1928511562594"><a name="p1928511562594"></a><a name="p1928511562594"></a>VECIN -&gt; VECCALC或VECCALC -&gt; VECOUT</p>
<p id="p4618926603"><a name="p4618926603"></a><a name="p4618926603"></a>VECIN、VECCALC、VECOUT -&gt; TSCM</p>
<p id="p161819261019"><a name="p161819261019"></a><a name="p161819261019"></a>VECOUT -&gt; GM</p>
<p id="p1961818261010"><a name="p1961818261010"></a><a name="p1961818261010"></a>A1、B1 -&gt; GM</p>
</td>
</tr>
</tbody>
</table>

## 调用示例<a name="section1491211256313"></a>

```
AscendC::TPipe pipe;
AscendC::TQue<AscendC::TPosition::CO1, 1> inQueueSrc;
AscendC::TQue<AscendC::TPosition::CO2, 1> outQueueDst;
...
AscendC::LocalTensor<half> srcLocal = inQueueSrc.AllocTensor<half>();
AscendC::LocalTensor<half> dstLocal = outQueueDst.AllocTensor<half>();
DataCopyParams intriParams;
DataCopyEnhancedParams enhancedParams;
enhancedParams.blockMode = BlockMode::BLOCK_MODE_MATRIX;
AscendC::DataCopy(dstLocal , srcLocal , intriParams, enhancedParams);
...
```

结果示例：

```
输入数据srcLocal ：[1 2 3 ... 512]
输出数据dstLocal ：[1 2 3 ... 512]
```

